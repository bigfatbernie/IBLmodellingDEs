%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%		Chapter 5 - Discrete Models
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{topic}[Difference Equations]


%\includegraphics*[width=300pt]{images/randomwalk.png}
%
%{\footnotesize (image from \href{https://commons.wikimedia.org/wiki/File:Random_walk_in2D_closeup.png}{Wikimedia Commons} created by Oleg Alexandrov)}
%
%\begin{center}
%	\includegraphics*[width=200pt]{images/SimpleRabbits2.png}
%	
%	{\footnotesize (image from Houman Madani)}	
%\end{center}

\vfil

\begin{center}
\begin{minipage}{300pt}
	\includegraphics*[width=300pt]{images/chap5-xkcd.png}

	\hfill {\footnotesize (image from \href{https://www.xkcd.com/947/}{xkcd - comic \#947})}
\end{minipage}
\end{center}
\end{topic}











%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  MODULE - Introduction to Difference Equations
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\begin{module}{Introduction to Difference Equations}
	\label{diff:intro}

	\input{modules/module23-diff-intro.tex}
	\input{modules/module23-diff-intro-noexercises.tex}
\end{module}



%\newpage
%
%\question
%	Core Exercise with several parts
%\begin{parts}
%	\item Part 1
%	\item Part 2
%\end{parts}
%
%\bookonlynewpage
%
%
%\question
%	One more core exercise
%
%
%
%











%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  MODULE - Solving Difference Equations
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\begin{module}{Solving Difference Equations}
	\label{diff:solve}

	\input{modules/module24-diff-solve.tex}
	\input{modules/module24-diff-solve-exercises.tex}
\end{module}



\begin{lesson}
	\Title{Solving Difference Equations}

\Heading{Textbook}
	\begin{itemize}
		\item Module 23
	\end{itemize}

\Heading{Objectives}
	\begin{itemize}
		\item Understand the two main ideas: expansion or educated guessing
		\item Use mathematical induction to show that the formula found is indeed the solution
	\end{itemize}
	
\Heading{Motivation} 


Difference equations are a bit different from Differential equations.

One of the possible ways to solve difference equations is very simple in its idea, but it is actually hard to do in practice.

The second method to solve this type of equations is similar to the method we used before for systems and second-order ODEs.

However, showing that a solution is indeed a solution is quite a bit more difficult. It involves using the Principle of Mathematical Induction (appendix 7.2).

\Heading{Preparation for Class}
\begin{itemize}
	\item Read textbook
	\item Watch videos
	\item Solve the core exercise \ref{de:de1}
\end{itemize}

\Heading{Tutorials and Projects}
\begin{itemize}
	\item Project \ref{proj:lungs}: \lungstitle
\end{itemize}



\end{lesson}





\question \label{de:de1}
	Consider the difference equation
	$$	u_{k+1} = 6 u_k - 9u_{k-1}	$$
	
\begin{parts}
	\item Find the solution that satisfies $u_0 = 1, u_1 = 3	$.
	\item Find the solution that satisfies $u_0 = 1, u_1 = 4$.
\end{parts}



\bookonlynewpage


\question
	Consider a difference equation that has solutions $u_k = r^k$ for $r=2$ and $r=3$ and satisfies the conditions $u_0 = 7$ and $u_1=6$.
	
	What is $u_{22}$?



\standardonlynewpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  MODULE - Modelling with Difference Equations
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\begin{module}{Modelling with Difference Equations}
	\label{diff:model}

	\input{modules/module25-diff-model.tex}
	\input{modules/module25-diff-model-exercises.tex}
\end{module}



\begin{lesson}
	\Title{Modelling with Difference Equations I}

\Heading{Textbook}
	\begin{itemize}
		\item Module 24
	\end{itemize}

\Heading{Objectives}
	\begin{itemize}
		\item Model economic quantities to obtain a difference equation
	\end{itemize}
	
\Heading{Motivation} 

Economic quantities often change in bursts, not continuously. That's what happens to a savings account of the example in the textbook. So difference equations are a good tool to model these quantities.

In lecture, the goal is to study the concept of effective annual interest.


\Heading{Preparation for Class}
\begin{itemize}
	\item Read textbook: Economic Models
	\item Watch the corresponding video
	\item Bring definition of {\tt effective annual interest}
\end{itemize}

\Heading{Tutorials and Projects}
\begin{itemize}
	\item Project \ref{proj:bullwhip} \bullwhiptitle
	\item Project \ref{proj:numericalPDE}: \numericalPDEtitle
	\item Project \ref{proj:lungs}:\lungstitle
	\item Project \ref{proj:zombies}: \zombiestitle
	\item Project \ref{proj:maximus}: \maximustitle
\end{itemize}


\end{lesson}



\begin{annotation}
\begin{goals}
	The effective annual interest rate is the interest rate with a compounding period of 1 year that gives the same result s the rate of $p\%$ compounded every $\alpha$ years.
\end{goals}
\end{annotation}
\question \label{de:economic}
	Let us expand on the economic example above.
	
	We put a certain amount of money in a savings bank account with an annual interest rate of $p\%$, and compounded at regular periods of $\alpha$ (in years). \\
	
	Even though we call $p\%$ the annual interest rate, because it is compounded during the year, at the end of the year the effective annual interest rate $p_{\rm eff}\%$ is actually higher.
	
	Calculate the effective interest rate $p_{\rm eff}\%$.


	

\bookonlynewpage



\begin{lesson}
	\Title{Modelling with Difference Equations II}

\Heading{Textbook}
	\begin{itemize}
		\item Module 24
	\end{itemize}

\Heading{Objectives}
	\begin{itemize}
		\item Model a population to obtain a difference equation
	\end{itemize}
	
\Heading{Motivation} 

We have modelled populations using differential equations. Populations can be modelled using both differential or difference equations. Which kind of equations to use depends on the goal of the model and the assumptions that we make.

In lecture, the goal is to study the concept of average lifespan.


\Heading{Preparation for Class}
\begin{itemize}
	\item Read textbook: Population Models
	\item Watch the first corresponding video
	\item Solve core exercise \ref{de:averagelifespan}
\end{itemize}

\Heading{Tutorials and Projects}
\begin{itemize}
	\item Project \ref{proj:bullwhip} \bullwhiptitle
	\item Project \ref{proj:numericalPDE}: \numericalPDEtitle
	\item Project \ref{proj:lungs}:\lungstitle
	\item Project \ref{proj:zombies}: \zombiestitle
	\item Project \ref{proj:maximus}: \maximustitle
\end{itemize}


\end{lesson}




\question \label{de:averagelifespan}
	The goal of this question is to try to understand the meaning of average lifespan.
\begin{annotation}
\begin{goals}
	\Goal{Pre-class question}
	The goal of this question is to prepare for calculating the average lifespan in the next page. \\

	In class do it quickly.
\end{goals}
\end{annotation}
\begin{parts}
	\item Consider a small tribe, where the people in there died at the ages:		
		\begin{graybox}
		\begin{center}
			42, 56, 46, 52, 5, 103, 47, 67, 67, 85, 57, 42, 47, 67, 46, 42, 5, 46, 57, 42.
		\end{center}
		\end{graybox}
		What is the average lifespan of this tribe's population? %51.05

	\item  Consider another small tribe, where people recorded their lifespans differently. Below is a table with the percentage of the population that died at each age:
		\begin{graybox}
		\begin{center}
		\begin{tabular}{c||c|c|c|c|c|c|c}
			\textbf{Percentage of population}
				& 2\% & 5\% & 9\% & 9\% & 16\% & 22\% & 37\% \\ \hline
			\textbf{Age at death}
				& 98 & 82 & 71 & 66 & 61 & 53 & 48\\
		\end{tabular}
		\end{center}
		\end{graybox}
		What is the average lifespan of this tribe's population? %57.57
\end{parts}
 

\vfill



\bookonlynewpage



\begin{annotation}
\begin{goals}
	Some hints:
	\begin{itemize}
		\item individual dying during season $k$ $\Leftrightarrow$ lifespan $= k$ seasons
		\item From previous two exercises, deduce that: average lifespan $=$ expected value of lifespan $\ell = E$:
		$$ E = \sum_{k=0}^\infty k \ell(k) $$
		\item $\displaystyle \sum_{k=1}^\infty k r^k = \frac{r}{(1-r)^2}$ for $|r|<1$.
		\item End result should be $\frac1\mu$.
\end{itemize}	
\end{goals}
\end{annotation}
\question
	Given a population with
	\begin{itemize}
		\item $\mu=$ probability that an individual will die between two seasons.
	\end{itemize}
\begin{parts}
	\item Define the following quantity
	\begin{itemize}
		\item $P(k)=$probability that an individual born at season $0$ is alive at the beginning of season $k$.
	\end{itemize}
	Find a model for $P(k)$.

	\item What is the probability of the individual dying during the k$^{\rm th}$ season?
	\item What is the average lifespan of an individual in this population?
\end{parts}




\bookonlynewpage




\begin{lesson}
	\Title{Modelling with Difference Equations III}

\Heading{Textbook}
	\begin{itemize}
		\item Module 24
	\end{itemize}

\Heading{Objectives}
	\begin{itemize}
		\item Model a population to obtain a system of difference equations
	\end{itemize}
	
\Heading{Motivation} 

We now turn our attention to a different type of population model. 
It's still a population model, but the reproduction of the population changes depending on the age.
This means that a system of difference equations is a good way to model this.

\Heading{Preparation for Class}
\begin{itemize}
	\item Watch the second video about Population Models
	\item Solve core exercise \ref{de:simplerabbits}
\end{itemize}

\Heading{Tutorials and Projects}
\begin{itemize}
	\item Project \ref{proj:bullwhip} \bullwhiptitle
	\item Project \ref{proj:numericalPDE}: \numericalPDEtitle
	\item Project \ref{proj:lungs}:\lungstitle
	\item Project \ref{proj:zombies}: \zombiestitle
	\item Project \ref{proj:maximus}: \maximustitle
\end{itemize}


\end{lesson}



\begin{annotation}
	\begin{goals}
		\Goal{Pre-class exercise.}
		\begin{itemize}
			\item In class solve it quickly.
			\item Let students know that they should use Mathematical Induction to prove that the Fibonacci sequence does indeed match the number of rabbits.
		\end{itemize}
\end{goals}
\end{annotation}
\begin{minipage}{.7\textwidth}
\question \label{de:simplerabbits}
	Consider a population of special rabbits. Once a pair of rabbits is born, they grow and one year later they are still immature. But two years after they are born they give birth to another pair of rabbits.
	Model this population of rabbits.
\end{minipage}
\hfill
\begin{minipage}{58pt}
	\includegraphics*[width=58pt]{images/module24-simple-life.pdf}
\end{minipage}
	


\bookonlynewpage


\question
	Consider another population of rabbits. This is the lifecycle of a pair of rabbits:

\begin{minipage}{.6\textwidth}
\begin{enumerate}[start=0,label=(year \arabic*)]
		\item Born
		\item Immature (no babies)
		\item Young Adult (1 pairs of babies)
		\item Adult (1 pair of babies)
		\item Old (no babies)
		\item Die
	\end{enumerate}	
\end{minipage}
\hfil
\begin{minipage}{75pt}
	\includegraphics*[width=75pt]{images/module24-complicated-life.pdf}
\end{minipage}
\begin{annotation}
	\begin{goals}
		\begin{itemize}
			\item Students might try to find a pattern. 
			\item It is possible, but very difficult.
			\item Hint: Use a system of difference equations. 
			\item In core exercise \ref{rabbitscomplicatedproof}, the students are asked to prove the formula.
		\end{itemize}
	\end{goals}
\end{annotation}
	
	Model this population of rabbits.
	
	




\standardonlynewpage



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  MODULE - Analysis of Difference Equations
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\begin{module}{Analysis of Difference Equations}
	\label{diff:analysis}

	\input{modules/module26-diff-analysis}
	\input{modules/module26-diff-analysis-exercises.tex}
\end{module}



\begin{lesson}
	\Title{Analysis of Difference Equations I}

\Heading{Textbook}
	\begin{itemize}
		\item Module 25
	\end{itemize}

\Heading{Objectives}
	\begin{itemize}
		\item Deduce properties of solutions of difference equations using different approaches
	\end{itemize}
	
\Heading{Motivation} 


Analyzing difference equations is similar to the different ways that we analyzed differential equations.

Approximating solutions though is much easier as a difference equation is already in the form of a numerical method.

\Heading{Preparation for Class}
\begin{itemize}
	\item Read textbook
	\item Solve the core exercise \ref{des:analysis1}.1--2.
\end{itemize}

\Heading{Tutorials and Projects}
\begin{itemize}
	\item Project \ref{proj:bullwhip} \bullwhiptitle
	\item Project \ref{proj:numericalPDE}: \numericalPDEtitle
	\item Project \ref{proj:lungs}:\lungstitle
	\item Project \ref{proj:zombies}: \zombiestitle
	\item Project \ref{proj:maximus}: \maximustitle
\end{itemize}


\end{lesson}




\question \label{des:analysis1}
	Consider the following difference equation:
		$$u_{k+1} = a(u_k - b)$$

	\begin{parts}
		\item What is the equilibrium solution?
		\item Are there 2-periodic solutions? I.e. satisfying
\begin{annotation}
	\begin{goals}
		\begin{itemize}
			\item In the calculations for .2, there is a step that involves a division by $(1-a^2)$, so it can only be done for $a \neq \pm 1$.
			\item The final result for .2 is:
			\begin{align*}
				a \neq \pm1. & \quad {\rm periodic} \Rightarrow u_0 = \frac{ab}{a-1}\\
							 & \Rightarrow  1-{\rm periodic} \\
				a = 1. 	& \quad {\rm periodic} \Rightarrow b=0  \\
						& \Rightarrow  1-{\rm periodic} \\
				a = -1. & \quad {\rm periodic} \Rightarrow b=0  \\
						& \Rightarrow  2-\text{periodic if } u_0\neq 0
			\end{align*}
		\end{itemize}
	\end{goals}
\end{annotation}
		\begin{itemize}
			\item $v_0=v_2=v_4=v_6=\cdots$
			\item $v_1=v_3=v_5=v_7=\cdots$
			\item $v_0\neq v_1$
		\end{itemize} 
		\item What happens to the solutions for different values of $a$?
		\item What happens to the solutions for different values of $b$?
	\end{parts}






\bookonlynewpage

\question \label{DE:drunkard}
	Consider a drunkard that is walking randomly near a cliff.

	\hfill \includegraphics*[width=250pt]{images/module26-drunk.pdf}
	\vspace{-70pt}

	\begin{minipage}{.9\textwidth}
		Consider this model for the drunkard's chance of getting to safety from falling off the cliff:
		\begin{itemize}
			\item $q$ is the probability that the drunkard will step towards safety;
			\item $1-q$ is the probability that the drunkard will step towards the cliff;
			\item $p_n=$ probability that the drunkard will get to safety if he is in step number $n$; 
			\item The drunkard will stop moving if he gets to safety (step $W$) or if he falls out of the cliff (step $0$); \\
	
			\item $p_n = q p_{n+1} + (1-q) p_{n-1}$. \\
		\end{itemize}
	\end{minipage}

	
\begin{annotation}
	\begin{goals}
		Question .3 is purposefully ambiguous about symmetry. What kind of symmetry is there? Is there any?
	\end{goals}
\end{annotation}
	\begin{parts}
		\item Is $p_n$ increasing or decreasing?
		\item What is $p_0$? What is $p_W$?
		\item Let $q=\frac12$. What is $p_{W/2}$? Is $p_n$ symmetric around $n=\frac{w}{2}$?
		\item Let $q>\frac12$. Is $p_{W/2} > \frac12$? Is $p_{W/2} < \frac12$? 
		\item How do solutions for $q=\alpha$ and $q=1-\alpha$ compare?
	\end{parts}


	
\bookonlynewpage

\hfill

\bookonlynewpage



\begin{lesson}
	\Title{Analysis of Difference Equations II}




\Heading{Textbook}
	\begin{itemize}
		\item Module 25
	\end{itemize}

\Heading{Objectives}
	\begin{itemize}
		\item Deduce properties of solutions of difference equations using different approaches
	\end{itemize}
	
\Heading{Motivation} 


Analyzing difference equations is similar to the different ways that we analyzed differential equations.

Approximating solutions though is much easier as a difference equation is already in the form of a numerical method.


\Heading{Preparation for Class}
\begin{itemize}
	\item Read textbook
	\item Finish the core exercise \ref{DE:drunkard}.
\end{itemize}

\Heading{Tutorials and Projects}
\begin{itemize}
	\item Project \ref{proj:bullwhip} \bullwhiptitle
	\item Project \ref{proj:numericalPDE}: \numericalPDEtitle
	\item Project \ref{proj:lungs}:\lungstitle
	\item Project \ref{proj:zombies}: \zombiestitle
	\item Project \ref{proj:maximus}: \maximustitle
\end{itemize}


\end{lesson}


\begin{minipage}{.45\textwidth}
\question \label{rabbitscomplicatedproof}
	Consider a population of rabbits with the following lifecycle:
	\begin{enumerate}[start=0,label=(year \arabic*)]
		\item Born
		\item Immature (no babies)
		\item Young Adult (1 pair of babies)
		\item Adult (1 pair of babies)
		\item Old (no babies)
		\item Die \\[5pt]
	\end{enumerate}	
	
\end{minipage}
\qquad
\begin{minipage}{.45\textwidth}
	Consider the definitions:
	\begin{itemize}
		\item We start with 1 pair of newborn rabbits in year 0;
		\item $r_n=$ number of pairs of rabbits alive during year $n$;
		\item $i_k=$ number of immature pairs;
		\item $y_k=$ number of young adult pairs;
		\item $a_k=$ number of adult pairs;
		\item $o_k=$ number of old pairs.
	\end{itemize}

\end{minipage}

	\begin{parts}
		\item Show that $b_k=b_{k-2}+b_{k-3}$.
		\item Show that $y_{k+1}=o_{k}+o_{k+1}$.
		\item Show that $r_{n} = r_{n-2}+r_{n-3}$.
	\end{parts}

\begin{annotation}
\begin{goals}
$$
r_k 
	= {\color{magenta}r_{k-1}-o_{k-1}}+{\color{blue}b_k}
$$

On the other hand, 
\begin{align*}
\color{magenta}
r_{k-1}-o_{k-1}
  & = b_{k-2} + 2 y_{k-2} + a_{k-2}  \\
  & = r_{k-2} + y_{k-2} - o_{k-2}
\end{align*}
and
\begin{align*}
\color{blue}
b_k 
  & = b_{k-2}+b_{k-3} \\
  & = y_{k-3} + a_{k-3} + b_{k-3} \\
  & = r_{k-3} - o_{k-3}	
\end{align*}


So we have
\begin{align*}
r_k & = {\color{magenta}r_{k-2} + {\color{black}\not} y_{k-2} - {\color{black}\not} o_{k-2}} + {\color{blue}r_{k-3} - {\color{black}\not}o_{k-3}} \\
& = r_{k-2} + r_{k-3}
\end{align*}

\end{goals}
\end{annotation}	

	
	

\standardonlynewpage

%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%%  MODULE - Nonlinear Models
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
%
%\begin{module}{Nonlinear Models}
%	\label{diff:nonlinear}
%
%	\input{modules/module27-diff-nonlinear}
%	\input{modules/module27-diff-nonlinear-exercises.tex}
%\end{module}
%
%
%
%\begin{lesson}
%	\Title{Nonlinear Models}
%
%	\Heading{Objectives}
%	\begin{itemize}
%		\item Bla
%	\end{itemize}
%	
%	\Heading{Motivation} 
%
%\end{lesson}
%
%
%\newpage
%
%\question
%	Core Exercise with several parts
%\begin{parts}
%	\item Part 1
%	\item Part 2
%\end{parts}
%
%\bookonlynewpage
%
%
%\question
%	One more core exercise
%
%

